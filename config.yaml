# VideoLingo Configuration (Optimized)
# For: Chatterbox TTS, CosyVoice3, Ollama LLM, WhisperX, htdemucs
# -------------------
# version: "3.1.0"
# author: "Huanshere"
# -------------------

## ======================== Basic Settings ======================== ##

display_language: "zh-CN"

# API settings (Ollama compatible)
# api:
#   key: 'ollama'
#   base_url: 'http://localhost:11434'
#   model: 'qwen2.5:14b'
#   llm_support_json: true

api:
  key: ''  # Set via OPENROUTER_API_KEY env var or paste here (DO NOT COMMIT!)
  base_url: 'https://openrouter.ai/api/v1'
  model: 'deepseek/deepseek-v3.2'
  llm_support_json: true
  proxy: ''  # HTTP proxy URL (e.g., 'http://127.0.0.1:7890')

# Number of LLM multi-threaded accesses, set to 1 if using local LLM
max_workers: 1

# Language settings
target_language: 'Русский'

# Whether to use Demucs for vocal separation before transcription
demucs: true

whisper:
  model: 'large-v3'
  language: 'en'
  detected_language: 'en'
  runtime: 'local'

# Whether to burn subtitles into the video
burn_subtitles: true

## ======================== Advanced Settings ======================== ##

# GPU acceleration for ffmpeg
ffmpeg_gpu: false

# Youtube settings
youtube:
  cookies_path: ''

# Default resolution for downloading YouTube videos
ytb_resolution: '1080'

subtitle:
  max_length: 75
  target_multiplier: 1.2

# Summary length
summary_length: 8000

# Maximum number of words for the first rough cut
max_split_length: 20

# Whether to reflect the translation result
reflect_translate: true

# Pause before translation for terminology review
pause_before_translate: false

# LLM-based translation verification (samples 5 translations to check quality)
# Cheap but effective - catches garbled/wrong language/empty translations
verify_translation: true

## ======================== Dubbing Settings ======================== ##

# TTS selection [chatterbox_tts, cosyvoice3]
tts_method: 'chatterbox_tts'

# Chatterbox TTS configuration (22 languages, zero-shot voice cloning)
# API: https://github.com/travisvn/chatterbox-tts-api
chatterbox_tts:
  api_url: 'http://localhost:4123'
  voice_clone_mode: 2
  exaggeration: 0.5
  cfg_weight: 0.4

# CosyVoice 3.0 configuration (9 languages, flow matching)
# Modes:
#   - cross_lingual: Voice cloning without reference text (most stable)
#   - zero_shot: Voice cloning with reference text (best voice quality)
#   - instruct2: Manual speed/emotion control via speed_instruction
#   - instruct2_auto: Automatic speed control based on duration estimation (reduces time stretching)
cosyvoice3:
  api_url: 'http://localhost:50000'
  mode: 'cross_lingual'
  sample_rate: 22050
  # For instruct2 mode only (manual instruction):
  # speed_instruction: 'speak naturally'

# Audio speed range
# For EN→RU translations (2-3x longer), increase accept/max
# rubberband preserves quality up to ~1.5x, ffmpeg atempo OK up to ~1.8x
speed_factor:
  min: 1
  accept: 1.4
  max: 1.6

# Merge audio configuration
min_subtitle_duration: 2.5
min_trim_duration: 3.5
tolerance: 1.5

# VAD-aligned subtitle starts
vad:
  enabled: false
  audio_source: 'vocal' # vocal or raw
  max_shift_ms: 250
  min_silence_len_ms: 300
  silence_offset_db: -16.0
  sample_ms: 30000
  max_segments: 20000
  min_speech_ratio: 0.15
  max_speech_ratio: 0.98

# Background ducking (sidechain compression) during voiceover
audio_ducking:
  enabled: true
  threshold: 0.02
  ratio: 4
  attack: 50
  release: 300
  makeup: 1.0
  background_gain: 1.0

## ======================== Additional settings ======================== ##

# Whisper model directory
model_dir: './_model_cache'

# Supported upload video formats
allowed_video_formats:
- 'mp4'
- 'mov'
- 'avi'
- 'mkv'
- 'flv'
- 'wmv'
- 'webm'

allowed_audio_formats:
- 'wav'
- 'mp3'
- 'flac'
- 'm4a'

# Spacy models
spacy_model_map:
  en: 'en_core_web_md'
  ru: 'ru_core_news_md'
  fr: 'fr_core_news_md'
  ja: 'ja_core_news_md'
  es: 'es_core_news_md'
  de: 'de_core_news_md'
  it: 'it_core_news_md'
  zh: 'zh_core_web_md'

# Languages that use space as separator
language_split_with_space:
- 'en'
- 'es'
- 'fr'
- 'de'
- 'it'
- 'ru'

# Languages that do not use space as separator
language_split_without_space:
- 'zh'
- 'ja'
